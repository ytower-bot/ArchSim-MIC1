FASE 5 - CICLO DE EXECUÇÃO
Data: 28/11/2025
Status: Completa

OBJETIVO
Implementar ciclo completo de execução de microinstrução: fetch, decode, execute, update.

CICLO DE EXECUÇÃO

Fase Fetch
- fetch_microinstruction() - Lê microinstrução da memória de controle no MPC
- Copia para MIR para decodificação
- Memória de controle indexada pelo valor atual do MPC

Fase Execute
- execute_datapath() - Pipeline completo do datapath:
  1. Decoder A: Seleciona registrador, carrega Latch A
  2. Decoder B: Seleciona registrador, carrega Latch B
  3. AMUX: Seleciona entrada da ALU (Latch A ou MBR)
  4. ALU: Executa operação aritmética/lógica
  5. MMUX: Atualiza flags N/Z baseado em resultado da ALU
  6. Shifter: Desloca resultado da ALU esquerda/direita
  7. Decoder C: Escreve resultado no registrador (se ENC=1)
  8. MAR/MBR: Operações de memória (se RD=1 ou WR=1)

Fase Update
- update_control() - Determina próximo MPC
- MMUX avalia condições de desvio
- Sequencial: MPC = MPC + 1
- Desvio: MPC = ADDR da microinstrução

Integração
- run_mic1_cycle() - Executa ciclo completo
- Incrementa contador de ciclos e relógio
- Mantém consistência de estado da CPU

BUGS CORRIGIDOS
- Inicialização de decoders em init_mic1()
- Removido malloc em init_decoder/init_decoderC
- Corrigido incremento duplicado de MPC em update_control()

ARQUIVOS MODIFICADOS
- src/mic1.c (+100 linhas)
- src/control_unit.c (+55 linhas)
- src/datapath.c (correções de bugs)
- include/mic1.h (+1 declaração)
- include/control_unit.h (+2 declarações)

ARQUIVOS CRIADOS
- src/tests/test_execution_cycle.c (160 linhas, 9 testes)

VALIDAÇÃO
Testes: 9/9 passando (100%)
- Inicialização da CPU verificada
- Carregamento de microprograma funcional
- Operação de fetch correta
- Execução sequencial verificada
- Execução multi-ciclo estável
- Operações do datapath funcionais
- Operações de decodificação precisas

Compilação limpa com -Wall -Wextra -std=c99

COMMIT
d705ead - feat: implement complete execution cycle
