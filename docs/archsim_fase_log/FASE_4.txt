FASE 4 - UNIDADE DE CONTROLE
Data: 28/11/2025
Status: Completa

OBJETIVO
Implementar componentes da unidade de controle para execução de microinstruções.

COMPONENTES IMPLEMENTADOS

MIR (Registrador de Microinstrução)
- run_mir() - Decodifica microinstrução de 32 bits em sinais de controle
- load_mir() - Carrega microinstrução da memória de controle
- Distribuição de sinais:
  Bit 31: AMUX
  Bits 30-29: COND
  Bits 28-26: JUMP
  Bits 25-23: JAM
  Bits 22-19: C (endereço Decoder C)
  Bits 18-15: B (endereço Decoder B)
  Bits 14-11: A (endereço Decoder A)
  Bits 10-9: SH (controle Shifter)
  Bit 8: ENC (habilitar escrita)
  Bit 7: F0 (controle ALU)
  Bit 6: F1 (controle ALU)
  Bit 5: RD (ler memória)
  Bit 4: WR (escrever memória)
  Bits 3-0: flags MBR
  Bits 7-0: ADDR (endereço de desvio)

MPC (Contador de Microprograma)
- increment_mpc() - Incrementa contador em 1
- load_mpc(address) - Carrega novo endereço para desvio
- run_mpc() - Busca próxima microinstrução da memória de controle

MMUX (Multiplexador de Microendereço)
- run_mmux() - Determina próximo valor de MPC
- Lógica de desvio:
  COND=00: Sequencial (MPC+1)
  COND=01: Desvia se N=1
  COND=10: Desvia se Z=1
  COND=11: Desvio incondicional
- Lê flags N/Z da ALU

AMUX (Multiplexador de Entrada da ALU)
- Seleciona entre Latch A (0) ou MBR (1) como entrada da ALU

Carregador de Microprograma
- init_control_memory() - Carrega ROM de microprograma
- load_microprogram_file() - Carrega de arquivo
- Microprograma básico com 10-20 instruções de teste

ARQUIVOS CRIADOS
- src/control_unit.c (640 linhas)

ARQUIVOS MODIFICADOS
- src/mic1.c (integração)
- include/control_unit.h (declarações atualizadas)

VALIDAÇÃO
Testes: 16/16 passando (100%)
- 7/7 testes AMUX
- 9/9 testes memória de controle
- Busca de microinstrução verificada
- Desvios condicionais verificados
- Tratamento de flags N/Z verificado

COMMITS
b5e7fbd - feat: implement AMUX component
bf6dd10 - feat: implement microprogram loader and control memory
